---
title: 前端资源增量更新
date: 2018-04-08 21:51:21
categories:
- 前端工程化

---
# 前端资源增量更新

随着前端的发展，大前端时代的到来，web 所承担数据量级越来越大，web 应用程序也越来越大，尤其现在 SPA 的各种框架大行其道，用户对体验的要求也越来越高，这对前端的性能要求也越来越高。

<!--more-->

## 问题
假如说一个前端 web 应用的 JS 代码或者 HTML 文件 经过压缩之后依旧很大(假如说超过10M)，每次更新之后都需要用户重新加载 JS 是不可接受的，那么怎么样从工程的角度解决这种问题？

- 首先工程的优化角度应该从 JS 等这类的静态资源来考虑，我们其实每次对代码改动经过压缩之后，只有很少一部分的代码发生变动，其他的大部分没有变。
- 如果我们能找到 newFile 和 oldFile 的 diff 差异的信息，然后根据根据差异信息，更新 oldFile 的文件，不就不用从新加载体积很大的静态资源了？ 
- 有点类似 git 的 diff 机制，每次只记录文件的变动部分，然后更新原始文件，这个问题就解决掉了！
- 那么问题来了，这个 diff 算法如何实现，其实自己手动实现也没啥复杂的，但是我还是去了全球最大的同性交友网站[here](https://github.com/kpdecker/jsdiff)找了个现成diff 算法。

- 
先看一下这个diff算法：
![](/images/diff-1.png)

- 这个算法输出的信息有点多余，不方便后面的处理，我们对结果简单处理一下
![](/images/diff-2.png)


## 实现

已经可以拿到 diff 的信息了，下面我们只需要是想一个 mergeDiff 的一个方法就可以了。

`mergeDiff(oldFile, diffInfo) 
` 
大概形如这样。
![](/images/diff-3.png)

### 输出结果
![](/images/diff-4.png)